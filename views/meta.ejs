<%
  // Site information
  const site_title = "Arafat's Tech Store";
  const site_keywords_base = "iarafat.store, iarafat, arafat, arafat rahman, arfat rahman nahid, Md. Arafat Rahman Nahid";
  const site_author = "Md. Arafat Rahman Nahid";
  const site_charset = "UTF-8";

  // Favicon
  const favicon = "/logo.ico"; // Correct path for favicon

  // Base URL for Open Graph metadata (use relative paths where possible)
  const baseUrl = process.env.BASE_URL || "https://iarafat.store"; // Use env var or production URL
  const og_type = "website"; // Default Open Graph type

  // Utility: Strip HTML tags and decode HTML entities
  function stripHTML(content) {
    if (!content) return "";
    return content.replace(/<\/?[^>]+(>|$)/g, "").replace(/&[a-z]+;/gi, "");
  }

  // Default metadata for pages
  let og_url = `${baseUrl}/${currentPage || ''}`.replace(/\/\//g, "/"); // Default og_url
  let og_image = "https://storage.arnms.com/og/Arafat-app.png"; // Default og_image
  let og_title = site_title; // Default title
  let og_description = "Stay tuned for more updates!"; // Default description
  let keywords = site_keywords_base; // Default keywords

  if (currentPage === "post" && typeof postSlug !== "undefined") {
    // Dynamic metadata for post pages
    og_url = `${baseUrl}/p/${postSlug}`; // Dynamic URL for post
    og_image = `https://storage.arnms.com/og/app/${postSlug}.png`; // Use external storage for images
    og_title = postTitle || "Untitled Post"; // Use dynamic title or fallback
    og_description = postContent
      ? stripHTML(postContent).substring(0, 150) + "..."
      : "Read this post on Arafat's Tech."; // Dynamic description with a fallback

    // Extract all words from the content and make them SEO-friendly (cleaning up short words, duplicates, etc.)
    const contentKeywords = postContent
      ? stripHTML(postContent)
          .split(/\s+/) // Split by whitespace
          .filter((word, index, arr) => word.length > 4 && arr.indexOf(word) === index) // Filter short words and duplicates
          .map((word) => word.toLowerCase()) // Convert to lowercase for consistency
          .join(", ") // Join words with commas, not semicolons
      : "";
    
    // Combine base keywords and content-derived keywords
    keywords = `${site_keywords_base}, ${contentKeywords}`; // Join without semicolons, ensure proper comma separation
  }

  // Page-specific metadata
  const pageMeta = {
    home: {
      title: site_title,
      description: "Arafat's Tech is the all-in solution for everything. Stay tuned.",
      keywords: site_keywords_base.replace(/, /g, ",\n"),
    },
    post: {
      title: og_title,
      description: og_description,
      keywords: keywords,
    },
    // Add more pages as needed
  };
%>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="<%= site_charset %>">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://iarafat.store/sitemap.xml" />
  <meta name="description" content="<%= pageMeta[currentPage]?.description || 'Explore amazing content on Arafat\'s Tech.' %>">
  <meta name="keywords" content="<%= pageMeta[currentPage]?.keywords || site_keywords_base %>">
  <meta name="author" content="<%= site_author %>">
  <link rel="icon" type="image/x-icon" href="<%= favicon %>"> <!-- Favicon Link -->
  <script type="application/ld+json">
  {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Arafat's Tech Store",
      "url": "https://iarafat.store",
      "description": "Arafat's Tech Store offers a wide range of tech products, gadgets, and accessories at competitive prices.",
      "image": "https://cdn.arnms.com/uploads/photos/featured-image.png",
      "sameAs": [
          "https://www.facebook.com/ArafatsTechWorld"
      ],
      "publisher": {
          "@type": "Organization",
          "name": "Arafat's Tech Store",
          "logo": "https://iarafat.store/logo.png",
          "telephone": "+8809638289168",
          "email": "arafat@iarafat.store",
          "address": {
              "@type": "PostalAddress",
              "streetAddress": "123 Tech Avenue",
              "addressLocality": "Dhaka",
              "addressRegion": "Dhaka",
              "postalCode": "1207",
              "addressCountry": {
                  "@type": "Country",
                  "name": "BD"
              }
          },
          "image": "https://iarafat.store/logo.png"
      }
  }
  </script>
  <!-- Open Graph Tags -->
  <meta property="og:title" content="<%= pageMeta[currentPage]?.title || site_title %>" />
  <meta property="og:description" content="<%= pageMeta[currentPage]?.description || 'Explore amazing content on Arafat\'s Tech.' %>" />
  <meta property="og:image" content="<%= og_image %>" />
  <meta property="og:url" content="<%= encodeURIComponent(og_url) %>" />
  <meta property="og:type" content="<%= og_type %>" />
  <meta property="og:site_name" content="Arafat's Tech Store" />
  <meta property="og:locale" content="en_US" /> <!-- Ensure the correct locale -->
  <!-- Twitter Card Tags (optional for better display on Twitter) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= pageMeta[currentPage]?.title || site_title %>">
  <meta name="twitter:description" content="<%= pageMeta[currentPage]?.description || 'Explore amazing content on Arafat\'s Tech.' %>">
  <meta name="twitter:image" content="<%= og_image %>">
  <meta name="twitter:url" content="<%= encodeURIComponent(og_url) %>">
  
  <title><%= pageMeta[currentPage]?.title || site_title %></title>  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVJkEZSMUkrQ6usKLE52Cqxp5OVTRzpHjxyV2D9Sort9dvUROwhktkv0FlsH9dJwKklE2lr85iKcw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/footer.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/post.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/styles.css">
  
  <!-- Import Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>